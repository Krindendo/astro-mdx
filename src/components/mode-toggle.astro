---
import { Icons } from "./icons";
import { Button } from "./ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "./ui/dropdown-menu";
---

<DropdownMenu>
  <DropdownMenuTrigger asChild>
    <Button variant="ghost" size="sm" className="h-8 w-8 px-0">
      <Icons.sun
        className="rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"
      />
      <Icons.moon
        className="absolute rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"
      />
      <span class="sr-only">Toggle theme</span>
    </Button>
  </DropdownMenuTrigger>
  <DropdownMenuContent align="end">
    <DropdownMenuItem
      id="select-light"
      className="text-muted-foreground hover:text-foreground"
    >
      <Icons.sun className="mr-2 h-4 w-4" />
      <span>Light</span>
    </DropdownMenuItem>
    <DropdownMenuItem
      id="select-dark"
      className="text-muted-foreground hover:text-foreground"
    >
      <Icons.moon className="mr-2 h-4 w-4" />
      <span>Dark</span>
    </DropdownMenuItem>
    <DropdownMenuItem
      id="select-system"
      className="text-muted-foreground hover:text-foreground"
    >
      <Icons.laptop className="mr-2 h-4 w-4" />
      <span>System</span>
    </DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>

<script is:inline>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }

  window.localStorage.setItem("theme", theme);

  //"light" | "dark" | "system"
  const setTheme = (theme) => {
    const element = document.documentElement;
    if (theme === "system") {
      theme = "light";
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        theme = "dark";
      }
    }

    if (theme === "dark") {
      element.classList.add("dark");
    } else {
      element.classList.remove("dark");
    }

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };

  document.getElementById("select-light").addEventListener("click", () => {
    setTheme("light");
  });
  document.getElementById("select-dark").addEventListener("click", () => {
    setTheme("dark");
  });
  document.getElementById("select-system").addEventListener("click", () => {
    setTheme("system");
  });
</script>
